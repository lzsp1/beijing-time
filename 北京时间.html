<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯«ç§’çº§åŒ—äº¬æ—¶é—´</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23ffffff' stroke='%23ffd700' stroke-width='8'/%3E%3Ccircle cx='50' cy='50' r='3' fill='%23000000'/%3E%3Cline x1='50' y1='50' x2='50' y2='25' stroke='%23000000' stroke-width='3' stroke-linecap='round'/%3E%3Cline x1='50' y1='50' x2='70' y2='60' stroke='%23000000' stroke-width='3' stroke-linecap='round'/%3E%3Cline x1='50' y1='15' x2='50' y2='10' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='85' y1='50' x2='90' y2='50' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='50' y1='85' x2='50' y2='90' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='15' y1='50' x2='10' y2='50' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='25' y1='25' x2='20' y2='20' stroke='%23000000' stroke-width='1.5'/%3E%3Cline x1='75' y1='25' x2='80' y2='20' stroke='%23000000' stroke-width='1.5'/%3E%3Cline x1='75' y1='75' x2='80' y2='80' stroke='%23000000' stroke-width='1.5'/%3E%3Cline x1='25' y1='75' x2='20' y2='80' stroke='%23000000' stroke-width='1.5'/%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }
        
        #time-container {
            text-align: center;
        }
        
        #date-info {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        #time {
            font-size: 120px;
            font-weight: bold;
        }
        
        #fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ff4500;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        #fullscreen-btn:hover {
            background-color: #ff6347;
        }
        
        #dev-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: #333;
            color: #aaa;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        #dev-btn:hover {
            background-color: #444;
            color: #ccc;
        }
        
        /* ç‰ˆæœ¬å·æ ·å¼ */
        #version {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #aaa;
            font-size: 12px;
            font-family: Arial, sans-serif;
            opacity: 0.8;
        }
        
        /* åˆ·æ–°æ¬¡æ•°æç¤ºæ ·å¼ */
        #refresh-counter {
            color: #666;
            font-size: 12px;
            font-family: Arial, sans-serif;
            opacity: 0.7;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: #222;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            min-width: 400px;
            position: relative;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #fff;
        }
        
        .modal p {
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-green {
            background-color: #4CAF50;
            color: #fff;
        }
        
        .btn-green:hover {
            background-color: #45a049;
        }
        
        .btn-red {
            background-color: #f44336;
            color: #fff;
        }
        
        .btn-red:hover {
            background-color: #da190b;
        }
        
        .btn-blue {
            background-color: #2196F3;
            color: #fff;
        }
        
        .btn-blue:hover {
            background-color: #0b7dda;
        }
        
        .input-container {
            margin: 20px 0;
        }
        
        .input-container input {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #333;
            color: #fff;
            width: 100%;
            max-width: 300px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: #fff;
        }
        
        .error-msg {
            color: #f44336;
            margin: 10px 0;
        }
        
        .creator-info {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .creator-name {
            font-size: 18px;
            color: #aaa;
        }
        
        /* æ£€æµ‹ç¯å¢ƒåŠ¨æ•ˆæ ·å¼ */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #333;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            color: #ddd;
            margin-bottom: 10px;
        }
        
        .loading-dots {
            display: flex;
            gap: 5px;
        }
        
        .loading-dot {
            width: 8px;
            height: 8px;
            background-color: #4CAF50;
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite both;
        }
        
        .loading-dot:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .loading-dot:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        
        /* ç¯å¢ƒæ£€æµ‹é€šè¿‡æ•ˆæœæ ·å¼ */
        .success-check {
            width: 50px;
            height: 50px;
            background-color: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: successPulse 0.6s ease-in-out;
        }
        
        @keyframes successPulse {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .success-check::after {
            content: 'âœ“';
            color: white;
            font-size: 30px;
            font-weight: bold;
        }
        
        .success-text {
            font-size: 18px;
            color: #4CAF50;
            margin-bottom: 10px;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* ç¯å¢ƒæœªé€šè¿‡æ•ˆæœæ ·å¼ */
        .error-check {
            width: 50px;
            height: 50px;
            background-color: #f44336;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: errorPulse 0.6s ease-in-out;
        }
        
        @keyframes errorPulse {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .error-check::after {
            content: 'âœ—';
            color: white;
            font-size: 30px;
            font-weight: bold;
        }
        
        .error-text {
            font-size: 18px;
            color: #f44336;
            margin-bottom: 10px;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å³ä¾§ä¼¸ç¼©æ¡†æ ·å¼ */
        .sidebar-container {
            position: absolute;
            top: auto;
            bottom: 80px;
            right: -250px;
            transform: translateY(0);
            width: 280px;
            background-color: rgba(30, 30, 0, 0.95);
            border-radius: 10px 0 0 10px;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
            transition: right 0.3s ease;
            z-index: 200;
            clear: both;
            float: none;
        }
        
        .sidebar-container.open {
            right: 0;
        }
        
        .sidebar-toggle {
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: rgba(30, 30, 30, 0.95);
            border: none;
            border-radius: 50%;
            color: #aaa;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .sidebar-toggle:hover {
            background-color: rgba(50, 50, 50, 0.95);
            color: #fff;
        }
        
        .sidebar-content {
            padding: 20px;
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .option-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .option-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .option-label {
            font-size: 16px;
            color: #ddd;
        }
        
        /* å¼€å…³æŒ‰é’®æ ·å¼ */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4CAF50;
        }
        
        input:focus + .toggle-slider {
            box-shadow: 0 0 1px #4CAF50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <button id="check-update-btn" style="position: absolute; top: 20px; left: 20px; background-color: #333; color: #aaa; border: none; padding: 8px 16px; font-size: 14px; cursor: pointer; border-radius: 5px; transition: all 0.3s;">æ›´æ–°å†…å®¹</button>
    <button id="fullscreen-btn">å…¨å±</button>
    <button id="settings-btn" style="position: absolute; bottom: 20px; left: 20px; background-color: #333; color: #aaa; border: none; padding: 8px 16px; font-size: 14px; cursor: pointer; border-radius: 5px; transition: all 0.3s;">æ›´å¤š</button>
    
    <div id="time-container">
        <div id="date-info"></div>
        <div id="time"></div>
    </div>
    
    <!-- å¼¹çª—å®¹å™¨ -->
    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close-btn" id="modal-close">&times;</button>
            <div id="modal-body">
                <!-- å¼¹çª—å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- åˆ·æ–°æ¬¡æ•°æç¤º -->
    <div id="refresh-container" style="position: absolute; bottom: 10px; right: 10px; display: flex; flex-direction: row; align-items: center; gap: 10px; width: auto;">
        <div id="refresh-counter" style="display: inline-block;"></div>
        <a href="#" id="reset-refresh" style="display: inline-block; color: #888; font-size: 12px; cursor: pointer; opacity: 0.7; text-decoration: underline;">é‡ç½®</a>
    </div>
    
    <!-- è®¾ç½®æŒ‰é’® -->

    
    <!-- éšè—çš„æ¯«ç§’æ˜¾ç¤ºå¼€å…³ï¼Œç”¨äºJavaScriptè·å–çŠ¶æ€ -->
    <div style="display: none;">
        <input type="checkbox" id="ms-toggle" checked>
    </div>
    
    <script>
        // è·å–DOMå…ƒç´ 
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const checkUpdateBtn = document.getElementById('check-update-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const modal = document.getElementById('modal');
        const modalClose = document.getElementById('modal-close');
        const modalBody = document.getElementById('modal-body');
        const dateInfo = document.getElementById('date-info');
        const timeElement = document.getElementById('time');
        const refreshCounter = document.getElementById('refresh-counter');
        const resetRefreshBtn = document.getElementById('reset-refresh');
        const msToggle = document.getElementById('ms-toggle');
        
        // åŠŸèƒ½åˆ‡æ¢ç›¸å…³å˜é‡
        let currentFeature = localStorage.getItem('currentFeature') || 'time'; // 'time' æˆ– 'countdown'
        let countdownDuration = parseInt(localStorage.getItem('countdownDuration') || '5'); // é»˜è®¤5åˆ†é’Ÿ
        let countdownEndTime = null;
        let countdownInterval = null;
        
        // å¼€å‘è€…æ¨¡å¼çŠ¶æ€
        let errorCount = 0;
        const MAX_ERRORS = 5;
        const LOCK_TIME = 1 * 60 * 1000; // 1åˆ†é’Ÿ
        const PASSWORD = '1313113';
        
        // è·å–æœ¬åœ°å­˜å‚¨çš„é”™è¯¯ä¿¡æ¯
        function getErrorInfo() {
            const info = localStorage.getItem('devErrorInfo');
            if (info) {
                return JSON.parse(info);
            }
            return { count: 0, lockUntil: 0 };
        }
        
        // ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°æœ¬åœ°å­˜å‚¨
        function saveErrorInfo(info) {
            localStorage.setItem('devErrorInfo', JSON.stringify(info));
        }
        
        // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
        function isLocked() {
            const info = getErrorInfo();
            return Date.now() < info.lockUntil;
        }
        
        // è·å–å‰©ä½™é”å®šæ—¶é—´
        function getRemainingLockTime() {
            const info = getErrorInfo();
            const remaining = info.lockUntil - Date.now();
            return remaining > 0 ? remaining : 0;
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            
            // æ ¼å¼åŒ–æ—¥æœŸä¿¡æ¯
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const weekday = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'][now.getDay()];
            
            // è®¡ç®—ç¬¬å‡ å‘¨
            const firstDay = new Date(year, 0, 1);
            const pastDays = (now - firstDay) / (24 * 60 * 60 * 1000);
            const weekNumber = Math.ceil((pastDays + firstDay.getDay() + 1) / 7);
            
            // æ ¼å¼åŒ–æ—¶é—´
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            // è·å–æ¯«ç§’æ˜¾ç¤ºçŠ¶æ€
            const showMs = msToggle.checked;
            
            let timeString;
            if (showMs) {
                const milliseconds = String(now.getMilliseconds()).padStart(3, '0');
                timeString = `${hours}:${minutes}:${seconds}.${milliseconds}`;
            } else {
                timeString = `${hours}:${minutes}:${seconds}`;
            }
            
            // æ›´æ–°DOM
            dateInfo.textContent = `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}ï¼Œç¬¬${weekNumber}å‘¨`;
            timeElement.textContent = timeString;
        }
        
        // å…¨å±åˆ‡æ¢åŠŸèƒ½
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
        
        // æ›´æ–°å…¨å±æŒ‰é’®æ–‡æœ¬
        function updateFullscreenBtn() {
            if (document.fullscreenElement) {
                fullscreenBtn.textContent = 'é€€å‡ºå…¨å±';
            } else {
                fullscreenBtn.textContent = 'å…¨å±';
            }
        }
        
        // æ˜¾ç¤ºå¼¹çª—
        function showModal(content) {
            modalBody.innerHTML = content;
            modal.style.display = 'flex';
        }
        
        // éšè—å¼¹çª—
        function hideModal() {
            modal.style.display = 'none';
        }
        
        // æ˜¾ç¤ºæ£€æµ‹ç¯å¢ƒåŠ¨æ•ˆ
        function showEnvironmentCheck() {
            const content = `
                <h2>åˆ¶ä½œäººå‘˜åå•</h2>
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">æ­£åœ¨æ£€æµ‹é”å®šçŠ¶æ€</div>
                    <div class="loading-dots">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            `;
            showModal(content);
            
            // æ¨¡æ‹Ÿæ£€æµ‹ç¯å¢ƒï¼Œ2ç§’åæ˜¾ç¤ºå¯†ç è¾“å…¥ç•Œé¢ï¼ˆå¸¦é€šè¿‡æ•ˆæœï¼‰
            setTimeout(() => {
                showPasswordInput(true);
            }, 2000);
        }
        
        // æ˜¾ç¤ºåˆ¶ä½œäººå‘˜åå•ç¡®è®¤å¼¹çª—
        function showDevConfirm() {
            const content = `
                <h2>åˆ¶ä½œäººå‘˜åå•</h2>
                <p>ç¡®å®šæ˜¾ç¤ºåˆ¶ä½œäººå‘˜ï¼Ÿ</p>
                <div class="btn-container">
                    <button class="btn btn-green" id="confirm-continue">ç»§ç»­</button>
                    <button class="btn btn-red" id="confirm-cancel">å–æ¶ˆ</button>
                </div>
            `;
            showModal(content);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('confirm-continue').addEventListener('click', showEnvironmentCheck);
            document.getElementById('confirm-cancel').addEventListener('click', hideModal);
        }
        
        // æ˜¾ç¤ºå¯†ç è¾“å…¥å¼¹çª—
        function showPasswordInput(showSuccess = false) {
            // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
            if (isLocked()) {
                let countdownTimer;
                
                // æ›´æ–°å‰©ä½™æ—¶é—´
                function updateRemainingTime() {
                    const remaining = Math.ceil(getRemainingLockTime() / 1000);
                    if (remaining <= 0) {
                        // é”å®šæ—¶é—´å·²è¿‡ï¼Œé‡æ–°æ£€æµ‹ç¯å¢ƒ
                        clearInterval(countdownTimer);
                        hideModal();
                        showEnvironmentCheck();
                        return;
                    }
                    
                    const minutes = Math.floor(remaining / 60);
                    const seconds = remaining % 60;
                    const timeElement = document.getElementById('lock-time');
                    if (timeElement) {
                        timeElement.textContent = `${minutes}åˆ†${seconds}ç§’`;
                    }
                }
                
                const content = `
                    <h2>åˆ¶ä½œäººå‘˜åå•</h2>
                    <div class="loading-container">
                        <div class="error-check"></div>
                        <div class="error-text">é”å®šæ£€æµ‹æœªé€šè¿‡</div>
                        <p style="color: #ddd; margin-top: 10px;">è¯·<span id="lock-time">0åˆ†0ç§’</span>åé‡è¯•</p>
                        <p style="color: #ddd; margin-top: 5px;">é”å®šæ—¶å¯æ­£å¸¸ä½¿ç”¨æ—¶é—´</p>
                    </div>
                    <div class="btn-container" style="margin-top: 20px;">
                        <button class="btn btn-red" id="lock-cancel">å…³é—­</button>
                    </div>
                `;
                showModal(content);
                
                // åˆå§‹åŒ–æ˜¾ç¤ºæ—¶é—´
                updateRemainingTime();
                // å¯åŠ¨å€’è®¡æ—¶å®šæ—¶å™¨
                countdownTimer = setInterval(updateRemainingTime, 1000);
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶ï¼Œæ¸…é™¤å®šæ—¶å™¨
                document.getElementById('lock-cancel').addEventListener('click', () => {
                    clearInterval(countdownTimer);
                    hideModal();
                });
                
                // å…³é—­æŒ‰é’®äº‹ä»¶ï¼Œæ¸…é™¤å®šæ—¶å™¨
                modalClose.addEventListener('click', () => {
                    clearInterval(countdownTimer);
                    hideModal();
                });
                
                // ç‚¹å‡»å¼¹çª—å¤–éƒ¨äº‹ä»¶ï¼Œæ¸…é™¤å®šæ—¶å™¨
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        clearInterval(countdownTimer);
                        hideModal();
                    }
                });
                
                return;
            }
            
            // æ„å»ºå¯†ç è¾“å…¥ç•Œé¢å†…å®¹ï¼Œæ ¹æ®showSuccesså‚æ•°å†³å®šæ˜¯å¦æ˜¾ç¤ºç¯å¢ƒæ£€æµ‹é€šè¿‡æ•ˆæœ
            const successSection = showSuccess ? `
                <div class="loading-container" style="margin-bottom: 20px;">
                    <div class="success-check"></div>
                    <div class="success-text">é”å®šæ£€æµ‹é€šè¿‡</div>
                </div>
            ` : '';
            
            const content = `
                <h2>åˆ¶ä½œäººå‘˜åå•</h2>
                ${successSection}
                <p>è¯·è¾“å…¥è®¿é—®å¯†ç </p>
                <div class="input-container">
                    <input type="password" id="password-input" placeholder="æœºä¼šæœ‰é™">
                </div>
                <div class="error-msg" id="password-error" style="display: none;"></div>
                <div class="btn-container">
                    <button class="btn btn-blue" id="password-confirm">ç¡®å®š</button>
                    <button class="btn btn-red" id="password-cancel">å–æ¶ˆ</button>
                </div>
            `;
            showModal(content);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const passwordInput = document.getElementById('password-input');
            const passwordError = document.getElementById('password-error');
            
            document.getElementById('password-confirm').addEventListener('click', () => {
                const password = passwordInput.value;
                if (password === PASSWORD) {
                    // å¯†ç æ­£ç¡®ï¼Œé‡ç½®é”™è¯¯è®¡æ•°
                    saveErrorInfo({ count: 0, lockUntil: 0 });
                    showCreatorInfo();
                } else {
                    // å¯†ç é”™è¯¯ï¼Œæ›´æ–°é”™è¯¯è®¡æ•°
                    const errorInfo = getErrorInfo();
                    errorInfo.count++;
                    
                    if (errorInfo.count >= MAX_ERRORS) {
                        // é”å®š10åˆ†é’Ÿ
                        errorInfo.lockUntil = Date.now() + LOCK_TIME;
                        const remaining = Math.ceil(LOCK_TIME / 1000);
                        const minutes = Math.floor(remaining / 60);
                        const seconds = remaining % 60;
                        passwordError.textContent = `å¯†ç é”™è¯¯ï¼Œå·²è¢«é”å®š${minutes}åˆ†${seconds}ç§’`;
                        passwordError.style.display = 'block';
                        
                        // 1ç§’åæ˜¾ç¤ºé”å®šå¼¹çª—
                        setTimeout(() => {
                            showPasswordInput(false);
                        }, 1000);
                    } else {
                        passwordError.textContent = `å¯†ç é”™è¯¯ï¼ˆ${errorInfo.count}/${MAX_ERRORS}ï¼‰ï¼Œå‰©ä½™${MAX_ERRORS - errorInfo.count}æ¬¡æœºä¼š`;
                        passwordError.style.display = 'block';
                    }
                    
                    saveErrorInfo(errorInfo);
                }
            });
            
            document.getElementById('password-cancel').addEventListener('click', hideModal);
        }
        
        // æ˜¾ç¤ºè®¾ç½®å¼¹çª—
        function showSettingsModal() {
            const content = `
                <h2 style="margin-bottom: 20px;">æ›´å¤š</h2>
                <div style="display: flex; gap: 20px; width: 700px; height: 400px;">
                    <!-- å·¦ä¾§å¯¼èˆª -->
                    <div style="width: 200px; background-color: rgba(50, 50, 50, 0.5); border-radius: 8px; padding: 15px;">
                        <div style="margin-bottom: 20px;"></div>
                        <div class="settings-nav-item active" data-category="general" style="padding: 12px; margin-bottom: 8px; border-radius: 5px; cursor: pointer; transition: all 0.3s; background-color: rgba(255, 255, 255, 0.2); color: #fff;">é€šç”¨</div>
                        <div class="settings-nav-item" data-category="features" style="padding: 12px; margin-bottom: 8px; border-radius: 5px; cursor: pointer; transition: all 0.3s; background-color: transparent; color: #aaa;">åŠŸèƒ½</div>
                        <div class="settings-nav-item" data-category="about" style="padding: 12px; margin-bottom: 8px; border-radius: 5px; cursor: pointer; transition: all 0.3s; background-color: transparent; color: #aaa;">å…³äº</div>
                    </div>
                    
                    <!-- å³ä¾§å†…å®¹ -->
                    <div style="flex: 1; background-color: rgba(50, 50, 50, 0.5); border-radius: 8px; padding: 25px;">
                        <!-- é€šç”¨è®¾ç½® -->
                        <div id="settings-general" class="settings-content">
                            <h3 style="margin-bottom: 25px; color: #fff; font-size: 18px;">é€šç”¨</h3>
                            <div class="option-item" style="margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center;">
                                <span class="option-label" style="font-size: 16px;">æ˜¾ç¤ºæ¯«ç§’</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="ms-toggle-modal" ${msToggle.checked ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <span class="option-label" style="font-size: 14px; color: #888;">è¯´æ˜ï¼šå…³é—­æ¯«ç§’æ˜¾ç¤ºå¯å‡å°‘å±å¹•åˆ·æ–°é¢‘ç‡ï¼Œå»¶é•¿å±å¹•å¯¿å‘½</span>
                            </div>
                        </div>
                        
                        <!-- å…³äºè®¾ç½® -->
                        <div id="settings-about" class="settings-content" style="display: none;">
                            <h3 style="margin-bottom: 25px; color: #fff; font-size: 18px;">å…³äº</h3>
                            <div class="option-item" style="border-bottom: 1px solid #333; margin-bottom: 25px; padding-bottom: 25px;">
                                <button class="btn btn-blue" style="width: 100%; padding: 12px; font-size: 16px;" id="show-creator-btn">åˆ¶ä½œäººå‘˜åå•</button>
                            </div>
                            <div class="option-item" style="text-align: center; margin-top: 30px;">
                                <div style="color: #aaa; font-size: 14px; margin-bottom: 15px;">v4.0.12</div>
                                <a href="https://beijingfortime.wordpress.com/" target="_blank" rel="noopener noreferrer" style="font-size: 14px; opacity: 0.8; text-decoration: underline; color: #aaa;">å®˜ç½‘</a>
                            </div>
                        </div>
                    </div>
                </div>
                <style>
                    .modal-content {
                        min-width: 800px;
                        min-height: 500px;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                    }
                    .settings-nav-item:hover {
                        background-color: rgba(255, 255, 255, 0.1) !important;
                        color: #ddd !important;
                    }
                    .settings-nav-item.active {
                        background-color: rgba(255, 255, 255, 0.2) !important;
                        color: #fff !important;
                    }
                </style>
            `;
            showModal(content);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('ms-toggle-modal').addEventListener('change', (e) => {
                msToggle.checked = e.target.checked;
                // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('showMilliseconds', msToggle.checked);
                // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                updateTime();
                // é‡æ–°è®¾ç½®æ›´æ–°é¢‘ç‡
                clearInterval(window.timeInterval);
                const updateInterval = msToggle.checked ? 1 : 1000;
                window.timeInterval = setInterval(updateTime, updateInterval);
            });
            
            document.getElementById('show-creator-btn').addEventListener('click', () => {
                hideModal();
                showEnvironmentCheck();
            });
            
            // æ·»åŠ è®¾ç½®åˆ†ç±»åˆ‡æ¢äº‹ä»¶
            const navItems = document.querySelectorAll('.settings-nav-item');
            const contentItems = document.querySelectorAll('.settings-content');
            
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeç±»å’Œæ ·å¼
                    navItems.forEach(nav => {
                        nav.classList.remove('active');
                        nav.style.backgroundColor = 'transparent';
                        nav.style.color = '#aaa';
                    });
                    
                    // éšè—æ‰€æœ‰å†…å®¹
                    contentItems.forEach(content => content.style.display = 'none');
                    
                    // æ·»åŠ å½“å‰activeç±»å’Œæ ·å¼
                    item.classList.add('active');
                    item.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
                    item.style.color = '#fff';
                    
                    // æ˜¾ç¤ºå½“å‰å†…å®¹
                    const category = item.dataset.category;
                    document.getElementById(`settings-${category}`).style.display = 'block';
                });
            });
        }
        
        // æ˜¾ç¤ºåˆ¶ä½œè€…ä¿¡æ¯
        function showCreatorInfo() {
            const content = `
                <div class="creator-info">åˆ¶ä½œè€…</div>
                <div class="creator-name"> </div>
                <div class="creator-name">HBC</div>
                <div class="creator-name"> </div>
                <div class="creator-name"> </div>
                <div style="margin-top: 10px; color: #aaa; font-size: 16px;">æ„Ÿè°¢ä½¿ç”¨ï¼</div>
            `;
            showModal(content);
        }
        
        // é‡ç½®åˆ·æ–°æ¬¡æ•°åŠŸèƒ½
        function resetRefreshCount() {
            // æ¸…é™¤localStorageä¸­çš„åˆ·æ–°ä¿¡æ¯
            localStorage.removeItem('refreshInfo');
            
            // æ›´æ–°æ˜¾ç¤º
            refreshCounter.textContent = 'æ‚¨ä»Šæ—¥å·²åˆ·æ–° 0 æ¬¡';
            refreshCounter.style.color = '#666';
            refreshCounter.style.opacity = '0.7';
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // å…¨å±æŒ‰é’®äº‹ä»¶
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            // å…¨å±çŠ¶æ€å˜åŒ–äº‹ä»¶
            document.addEventListener('fullscreenchange', updateFullscreenBtn);
            
            // æ£€æŸ¥æ›´æ–°æŒ‰é’®äº‹ä»¶
            checkUpdateBtn.addEventListener('click', manualCheckUpdate);
            
            // æ·»åŠ æ£€æŸ¥æ›´æ–°æŒ‰é’®é¼ æ ‡æ‚¬åœæ•ˆæœ
            checkUpdateBtn.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#444';
                this.style.color = '#ccc';
            });
            
            checkUpdateBtn.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '#333';
                this.style.color = '#aaa';
            });
            
            // è®¾ç½®æŒ‰é’®äº‹ä»¶
            settingsBtn.addEventListener('click', showSettingsModal);
            
            // æ·»åŠ è®¾ç½®æŒ‰é’®é¼ æ ‡æ‚¬åœæ•ˆæœ
            settingsBtn.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#444';
                this.style.color = '#ccc';
            });
            
            settingsBtn.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '#333';
                this.style.color = '#aaa';
            });
            
            // å…³é—­å¼¹çª—äº‹ä»¶
            modalClose.addEventListener('click', hideModal);
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­å¼¹çª—
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });
            
            // é‡ç½®åˆ·æ–°æ¬¡æ•°æŒ‰é’®äº‹ä»¶
            resetRefreshBtn.addEventListener('click', (e) => {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤è·³è½¬è¡Œä¸º
                resetRefreshCount();
            });
        }
        
        // æ›´æ–°åˆ¶ä½œäººå‘˜åå•æŒ‰é’®æ–‡æœ¬ï¼ˆå·²åºŸå¼ƒï¼Œä¸å†ä½¿ç”¨ï¼‰
        function updateDevBtnText() {
            // å‡½æ•°å·²åºŸå¼ƒï¼Œä¸å†ä½¿ç”¨
        }
        
        // è·å–å½“å‰æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        // é‡ç½®åˆ·æ–°æ¬¡æ•°
        function resetDailyRefreshCount() {
            const today = getTodayDate();
            const refreshInfo = { count: 0, date: today };
            localStorage.setItem('refreshInfo', JSON.stringify(refreshInfo));
            refreshCounter.textContent = `æ‚¨ä»Šæ—¥å·²åˆ·æ–° 0 æ¬¡`;
            refreshCounter.style.color = '#666';
            refreshCounter.style.opacity = '0.7';
        }
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®åˆ·æ–°æ¬¡æ•°
        function checkAndResetRefreshCount() {
            const today = getTodayDate();
            let refreshInfo = localStorage.getItem('refreshInfo');
            
            if (refreshInfo) {
                refreshInfo = JSON.parse(refreshInfo);
                if (refreshInfo.date !== today) {
                    resetDailyRefreshCount();
                }
            } else {
                resetDailyRefreshCount();
            }
        }
        
        // è®¾ç½®æ¯å¤©0ç‚¹è‡ªåŠ¨é‡ç½®åˆ·æ–°æ¬¡æ•°çš„å®šæ—¶å™¨
        function setupDailyResetTimer() {
            // è·å–å½“å‰æ—¶é—´
            const now = new Date();
            // è®¡ç®—è·ç¦»å½“å¤©ç»“æŸçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            const timeUntilMidnight = tomorrow.getTime() - now.getTime();
            
            // è®¾ç½®å®šæ—¶å™¨ï¼Œåœ¨å½“å¤©ç»“æŸæ—¶é‡ç½®åˆ·æ–°æ¬¡æ•°
            setTimeout(() => {
                resetDailyRefreshCount();
                // æ¯å¤©é‡å¤è®¾ç½®å®šæ—¶å™¨
                setupDailyResetTimer();
            }, timeUntilMidnight);
        }
        
        // åˆ·æ–°æ¬¡æ•°è®¡æ•°åŠŸèƒ½
        function updateRefreshCount() {
            // å…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®
            checkAndResetRefreshCount();
            
            const today = getTodayDate();
            
            // ä»localStorageè·å–åˆ·æ–°ä¿¡æ¯
            let refreshInfo = localStorage.getItem('refreshInfo');
            if (!refreshInfo) {
                // ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œåˆå§‹åŒ–
                refreshInfo = { count: 0, date: today };
            } else {
                refreshInfo = JSON.parse(refreshInfo);
            }
            
            // åˆ·æ–°æ¬¡æ•°+1
            refreshInfo.count++;
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('refreshInfo', JSON.stringify(refreshInfo));
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºä¸åˆè§„æ•°å­—
            const invalidNumbers = [78, 91, 9178, 7891, 250];
            if (invalidNumbers.includes(refreshInfo.count)) {
                refreshCounter.textContent = 'åˆ·æ–°æ•°å­—ä¸åˆè§„';
                // å¯ä»¥æ·»åŠ æ ·å¼å˜åŒ–ï¼Œè®©æç¤ºæ›´æ˜æ˜¾
                refreshCounter.style.color = '#f44336';
                refreshCounter.style.opacity = '0.9';
            } else {
                refreshCounter.textContent = `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡`;
                // æ¢å¤é»˜è®¤æ ·å¼
                refreshCounter.style.color = '#666';
                refreshCounter.style.opacity = '0.7';
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ„Ÿæƒ…æ•°å­—ï¼Œæ˜¾ç¤ºç¥ç¦å¼¹çª—
            const loveNumbers = [520, 1314, 1314520, 5201314];
            if (loveNumbers.includes(refreshInfo.count)) {
                // æ„Ÿæƒ…ç¥ç¦è¯­å½•æ•°ç»„
                const loveMessages = [
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿ä½ æ‹¥æœ‰ç¾å¥½çš„çˆ±æƒ…ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿å¤©ä¸‹æœ‰æƒ…äººç»ˆæˆçœ·å±ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿ä½ çš„ç”Ÿæ´»å……æ»¡çˆ±ä¸æ¸©æš–ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿æ¯ä¸€ä¸ªæ—¥å­éƒ½æœ‰çˆ±çš„é™ªä¼´ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿çˆ±ä¸ä½ åŒåœ¨ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿ä½ çš„çˆ±æƒ…å¦‚èœœèˆ¬ç”œç¾ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼`,
                    `æ‚¨ä»Šæ—¥å·²åˆ·æ–° ${refreshInfo.count} æ¬¡ï¼Œæ„¿ä½ çš„å¿ƒæ°¸è¿œè¢«çˆ±å¡«æ»¡ï¼`
                ];
                
                // éšæœºé€‰æ‹©ä¸€æ¡ç¥ç¦è¯­
                const randomMessage = loveMessages[Math.floor(Math.random() * loveMessages.length)];
                
                // æ˜¾ç¤ºç¥ç¦å¼¹çª—
                const content = `
                    <h2>ğŸ’– ç¥ç¦</h2>
                    <p style="font-size: 18px; color: #4CAF50; margin: 20px 0;">${randomMessage}</p>
                    <div class="btn-container">
                        <button class="btn btn-green" id="love-ok">å¥½çš„</button>
                    </div>
                `;
                showModal(content);
                
                // å¥½çš„æŒ‰é’®äº‹ä»¶
                document.getElementById('love-ok').addEventListener('click', hideModal);
            }
        }
        
        // æ£€æŸ¥æ–°ç‰ˆæœ¬å¹¶æ˜¾ç¤ºæ›´æ–°å†…å®¹
        function checkForUpdates() {
            // å½“å‰ç‰ˆæœ¬
            const currentVersion = '4.0.13';
            
            // ä»update.jsonè·å–æœ€æ–°ç‰ˆæœ¬
            fetch('/update.json', {
                cache: 'no-cache', // ä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿ä»æœåŠ¡å™¨è·å–æœ€æ–°å†…å®¹
                headers: {
                    'Accept': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
                    if (data.version !== currentVersion) {
                        // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡è¯¥ç‰ˆæœ¬çš„æ›´æ–°å†…å®¹
                        const shownVersions = JSON.parse(localStorage.getItem('shownVersions') || '[]');
                        if (!shownVersions.includes(data.version)) {
                            // æ˜¾ç¤ºæ›´æ–°å†…å®¹
                            let changelogHTML = '<ul style="list-style-type: none; padding: 0; margin: 20px 0;">';
                            data.changelog.forEach(item => {
                                changelogHTML += `<li style="margin: 8px 0; padding-left: 20px; position: relative;">\n`;
                                changelogHTML += `  <span style="position: absolute; left: 0; color: #4CAF50;">â€¢</span>\n`;
                                changelogHTML += `  ${item}\n`;
                                changelogHTML += `</li>`;
                            });
                            changelogHTML += '</ul>';
                            
                            const content = `
                                <h2 style="text-align: left;">ç‰ˆæœ¬ ${data.version} æ›´æ–°å†…å®¹</h2>
                                <div style="margin: 20px 0; text-align: left;">
                                    ${changelogHTML}
                                </div>
                                <div style="color: #aaa; font-size: 14px; margin-top: 20px; text-align: left;">
                                    æœ€åæ›´æ–°ï¼š${data.lastUpdate}
                                </div>
                                <div class="btn-container" style="margin-top: 30px; justify-content: flex-start;">
                                    <button class="btn btn-green" id="update-content-ok">ç¡®å®š</button>
                                </div>
                            `;
                            showModal(content);
                            
                            // ç¡®å®šæŒ‰é’®äº‹ä»¶
                            document.getElementById('update-content-ok').addEventListener('click', hideModal);
                            
                            // è®°å½•å·²æ˜¾ç¤ºçš„ç‰ˆæœ¬
                            shownVersions.push(data.version);
                            localStorage.setItem('shownVersions', JSON.stringify(shownVersions));
                        }
                    }
                })
                .catch(error => {
                    console.log('è·å–æ›´æ–°å†…å®¹å¤±è´¥:', error);
                });
        }
        
        // åˆå§‹åŒ–
        function init() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®
            const savedShowMs = localStorage.getItem('showMilliseconds');
            if (savedShowMs !== null) {
                msToggle.checked = savedShowMs === 'true';
            }
            
            // å¯åŠ¨æ—¶é—´æ›´æ–°
            updateTime();
            // æ ¹æ®æ¯«ç§’æ˜¾ç¤ºè®¾ç½®è°ƒæ•´æ›´æ–°é¢‘ç‡
            const updateInterval = msToggle.checked ? 1 : 1000;
            window.timeInterval = setInterval(updateTime, updateInterval);
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            initEventListeners();
            
            // åˆå§‹åŒ–å…¨å±æŒ‰é’®æ–‡æœ¬
            updateFullscreenBtn();
            
            // è®¾ç½®æ¯å¤©0ç‚¹è‡ªåŠ¨é‡ç½®åˆ·æ–°æ¬¡æ•°çš„å®šæ—¶å™¨
            setupDailyResetTimer();
            
            // æ›´æ–°å¹¶æ˜¾ç¤ºåˆ·æ–°æ¬¡æ•°
            updateRefreshCount();
        }
        
        // Service Workeræ³¨å†Œå’Œè‡ªåŠ¨æ›´æ–°åŠŸèƒ½
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('sw.js')
                        .then((registration) => {
                            console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                            
                            // ç›‘å¬æ›´æ–°äº‹ä»¶
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // æ–°çš„Service Workerå·²å®‰è£…ï¼Œæ˜¾ç¤ºæ›´æ–°æç¤º
                                        showUpdateNotification();
                                    }
                                });
                            });
                        })
                        .catch((error) => {
                            console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                        });
                });
                
                // ç›‘å¬æ§åˆ¶å˜åŒ–äº‹ä»¶
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (refreshing) return;
                    refreshing = true;
                    window.location.reload();
                });
            }
        }
        
        // æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
        function showUpdateNotification() {
            const content = `
                <h2>ğŸ‰ å‘ç°æ–°ç‰ˆæœ¬</h2>
                <p>é¡µé¢å·²æ›´æ–°ï¼Œæ˜¯å¦ç«‹å³åˆ·æ–°è·å–æœ€æ–°å†…å®¹ï¼Ÿ</p>
                <div class="btn-container">
                    <button class="btn btn-green" id="update-now">ç«‹å³åˆ·æ–°</button>
                    <button class="btn btn-red" id="update-later">ç¨åæ›´æ–°</button>
                </div>
            `;
            showModal(content);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            document.getElementById('update-now').addEventListener('click', () => {
                hideModal();
                // å‘é€æ¶ˆæ¯ç»™Service Workerï¼Œè¦æ±‚è·³è¿‡ç­‰å¾…
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                }
            });
            
            document.getElementById('update-later').addEventListener('click', hideModal);
        }
        
        // æ˜¾ç¤ºæ›´æ–°å†…å®¹å‡½æ•°
        function manualCheckUpdate() {
            // æœ¬åœ°é»˜è®¤æ›´æ–°å†…å®¹ï¼Œç¡®ä¿å³ä½¿ç½‘ç»œå¤±è´¥ä¹Ÿèƒ½æ˜¾ç¤º
            const defaultUpdateData = {
                version: '4.0.13',
                lastUpdate: '2025-12-08',
                changelog: [
                    'å°†è®¾ç½®åŠŸèƒ½æ”¹ä¸ºæŒ‰é’®å¼¹å¤§çª—å£',
                    'ä¿®å¤äº†æ›´æ–°å†…å®¹æ— æ³•æ˜¾ç¤ºçš„é—®é¢˜',
                    'æ·»åŠ äº†é»˜è®¤æ›´æ–°æ•°æ®ï¼Œç¡®ä¿å§‹ç»ˆæ˜¾ç¤ºæ›´æ–°å†…å®¹',
                    'ä¼˜åŒ–äº†è®¾ç½®é¢æ¿å¸ƒå±€å’Œæ ·å¼',
                    'ä¿®å¤äº†åˆ†ç±»åˆ‡æ¢æ—¶çš„çŠ¶æ€ç®¡ç†é—®é¢˜'
                ]
            };
            
            // ä»update.jsonè·å–æ›´æ–°å†…å®¹
            fetch('/update.json', {
                cache: 'no-cache', // ä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿ä»æœåŠ¡å™¨è·å–æœ€æ–°å†…å®¹
                headers: {
                    'Accept': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    // æ£€æŸ¥dataæ˜¯å¦åŒ…å«å¿…è¦çš„å­—æ®µï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®
                    if (!data || !data.version || !Array.isArray(data.changelog)) {
                        data = defaultUpdateData;
                    }
                    
                    // æ„å»ºæ›´æ–°å†…å®¹HTML
                    let changelogHTML = '<ul style="list-style-type: none; padding: 0; margin: 20px 0;">';
                    data.changelog.forEach(item => {
                        changelogHTML += `<li style="margin: 8px 0; padding-left: 20px; position: relative;">\n`;
                        changelogHTML += `  <span style="position: absolute; left: 0; color: #4CAF50;">â€¢</span>\n`;
                        changelogHTML += `  ${item}\n`;
                        changelogHTML += `</li>`;
                    });
                    changelogHTML += '</ul>';
                    
                    // æ˜¾ç¤ºæ›´æ–°å†…å®¹å¼¹çª—
                    const content = `
                        <h2 style="text-align: left;">ç‰ˆæœ¬ ${data.version} æ›´æ–°å†…å®¹</h2>
                        <div style="margin: 20px 0; text-align: left;">
                            ${changelogHTML}
                        </div>
                        <div style="color: #aaa; font-size: 14px; margin-top: 20px; text-align: left;">
                            æœ€åæ›´æ–°ï¼š${data.lastUpdate}
                        </div>
                        <div class="btn-container" style="margin-top: 30px; justify-content: flex-start;">
                            <button class="btn btn-green" id="update-content-ok">ç¡®å®š</button>
                        </div>
                    `;
                    showModal(content);
                    
                    // ç¡®å®šæŒ‰é’®äº‹ä»¶
                    document.getElementById('update-content-ok').addEventListener('click', hideModal);
                })
                .catch(error => {
                    console.log('è·å–æ›´æ–°å†…å®¹å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', error);
                    
                    // ä½¿ç”¨é»˜è®¤æ•°æ®æ˜¾ç¤ºæ›´æ–°å†…å®¹
                    const data = defaultUpdateData;
                    
                    // æ„å»ºæ›´æ–°å†…å®¹HTML
                    let changelogHTML = '<ul style="list-style-type: none; padding: 0; margin: 20px 0;">';
                    data.changelog.forEach(item => {
                        changelogHTML += `<li style="margin: 8px 0; padding-left: 20px; position: relative;">\n`;
                        changelogHTML += `  <span style="position: absolute; left: 0; color: #4CAF50;">â€¢</span>\n`;
                        changelogHTML += `  ${item}\n`;
                        changelogHTML += `</li>`;
                    });
                    changelogHTML += '</ul>';
                    
                    // æ˜¾ç¤ºæ›´æ–°å†…å®¹å¼¹çª—
                    const content = `
                        <h2 style="text-align: left;">ç‰ˆæœ¬ ${data.version} æ›´æ–°å†…å®¹</h2>
                        <div style="margin: 20px 0; text-align: left;">
                            ${changelogHTML}
                        </div>
                        <div style="color: #aaa; font-size: 14px; margin-top: 20px; text-align: left;">
                            æœ€åæ›´æ–°ï¼š${data.lastUpdate}
                        </div>
                        <div class="btn-container" style="margin-top: 30px; justify-content: flex-start;">
                            <button class="btn btn-green" id="update-content-ok">ç¡®å®š</button>
                        </div>
                    `;
                    showModal(content);
                    
                    // ç¡®å®šæŒ‰é’®äº‹ä»¶
                    document.getElementById('update-content-ok').addEventListener('click', hideModal);
                });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            init();
            registerServiceWorker();
        });
    </script>
</body>
</html>